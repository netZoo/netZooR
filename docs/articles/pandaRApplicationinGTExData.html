<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="netZooR">
<title>Building PANDA Regulatory Networks from GTEx Gene Expression Data in R • netZooR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building PANDA Regulatory Networks from GTEx Gene Expression Data in R">
<meta property="og:description" content="netZooR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">netZooR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.17</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ALPACA.html">Detecting differential modules using ALPACA</a>
    <a class="dropdown-item" href="../articles/ApplicationinGTExData.html">Building PANDA and LIONESS Regulatory Networks from GTEx Gene Expression Data in R</a>
    <a class="dropdown-item" href="../articles/ApplicationwithTBdataset.html">netZooR application with TB dataset</a>
    <a class="dropdown-item" href="../articles/CONDOR.html">Using CONDOR for community detection in bipartite graphs</a>
    <a class="dropdown-item" href="../articles/EGRET_toy_example.html">Constructing genotype-specific gene regulatory networks with EGRET</a>
    <a class="dropdown-item" href="../articles/LionessApplicationinGTExData.html">Comparing LIONESS Regulatory Networks using limma</a>
    <a class="dropdown-item" href="../articles/MONSTER.html">An Introduction to the MONSTER Package</a>
    <a class="dropdown-item" href="../articles/SAMBAR.html">SAMBAR: Subtyping Agglomerated Mutations By Annotation Relations</a>
    <a class="dropdown-item" href="../articles/TutorialOTTER.html">Inferring Gene Regulatory Networks from GTEx Gene Expression Data in R with OTTER</a>
    <a class="dropdown-item" href="../articles/pandaR.html">An Introduction to the pandaR Package</a>
    <a class="dropdown-item" href="../articles/pandaRApplicationinGTExData.html">Building PANDA Regulatory Networks from GTEx Gene Expression Data in R</a>
    <a class="dropdown-item" href="../articles/yarn.html">YARN: Robust Multi-Tissue RNA-Seq Preprocessing and Normalization</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/netZoo/netZooR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Building PANDA Regulatory Networks from GTEx Gene Expression Data in R</h1>
                        <h4 data-toc-skip class="author">Camila
Lopes-Ramos</h4>
            
            <h4 data-toc-skip class="date">2020-10-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/netZoo/netZooR/blob/HEAD/vignettes/pandaRApplicationinGTExData.Rmd" class="external-link"><code>vignettes/pandaRApplicationinGTExData.Rmd</code></a></small>
      <div class="d-none name"><code>pandaRApplicationinGTExData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we will build one regulatory network for LCL cell
line samples and one for whole blood samples from the GTEx gene
expression data using the netZooR package. Next, we will compare the two
networks, and find the pathways enriched for genes differentially
targeted between the LCL cell line and whole blood.</p>
<p>Cell lines are an essential tool in biomedical research and often
used as surrogates for tissues. LCLs (obtained from the transformation
of B cells present in whole blood) are among the most widely used
continuous cell lines with the ability to proliferate indefinitely. By
comparing the regulatory networks of LCL cell lines with its tissue of
origin (whole blood), we find that LCLs exhibit large changes in their
patterns of transcription factor regulation, specifically a loss of
repressive transcription factor targeting of cell cycle genes.</p>
<div class="section level3">
<h3 id="install-packages">Install packages<a class="anchor" aria-label="anchor" href="#install-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>   </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span>,repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span>  </span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"fgsea"</span><span class="op">)</span>   </span>
<span><span class="co"># install.packages("reshape2",repos = "http://cran.us.r-project.org")   </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span>,repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span>  </span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>    </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"netZoo/netZooR"</span>, build_vignettes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-packages">Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/netZoo/netZooR" class="external-link">netZooR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ctlab/fgsea/" class="external-link">fgsea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="panda">PANDA<a class="anchor" aria-label="anchor" href="#panda"></a>
</h2>
<div class="section level3">
<h3 id="panda-overview">PANDA Overview<a class="anchor" aria-label="anchor" href="#panda-overview"></a>
</h3>
<p>PANDA (Passing Attributes between Networks for Data Assimilation) is
a method for constructing gene regulatory networks. It uses message
passing to find congruence between 3 different data layers:
protein-protein interaction (PPI), gene expression, and transcription
factor (TF) motif data.</p>
<p>More details can be found in the published paper <a href="https://doi.org/10.1371/journal.pone.0064832" class="external-link uri">https://doi.org/10.1371/journal.pone.0064832</a>.</p>
</div>
<div class="section level3">
<h3 id="building-a-panda-regulatory-network">Building a PANDA regulatory network<a class="anchor" aria-label="anchor" href="#building-a-panda-regulatory-network"></a>
</h3>
<p>Now we locate our ppi and motif priors. The ppi represents physical
interactions between transcription factor proteins, and is an undirected
network. The transcription factor motif prior represents putative
regulation events where a transcription factor binds in the promotor of
a gene to regulate its expression, as predicted by the presence of
transcription factor binding motifs in the promotor region of the gene.
The motif prior is thus a directed network linking transcription factors
to their predicted gene targets. These are small example priors for the
purposes of demonstrating this method. A complete set of motif priors by
species can be downloaded from: <a href="https://sites.google.com/a/channing.harvard.edu/kimberlyglass/tools/resources" class="external-link uri">https://sites.google.com/a/channing.harvard.edu/kimberlyglass/tools/resources</a><br>
The function sourcePPI() can be used to source the protein-protein
interaction network from the STRING database, but it does so only to
produce an unweighted network that aggregates all types of interactions
not only the physical interaction subnetwork. Please refer to STRINGdb
website or R package to specify a PPI network suited for your
application.</p>
<p>Let’s take a look at the priors:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download motif and ppi file from AWS Bucket</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O  https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/motif_subset.txt"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/ppi_subset.txt"</span><span class="op">)</span></span>
<span><span class="va">motif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./motif_subset.txt"</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span>, header<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./ppi_subset.txt"</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span>, header<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">ppi</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      V1      V2    V3</span></span>
<span><span class="co">#&gt; 1 ASCL1   ASCL1 1.000</span></span>
<span><span class="co">#&gt; 2 ASCL1 BHLHE41 0.314</span></span>
<span><span class="co">#&gt; 3 ASCL1    DLX3 0.188</span></span>
<span><span class="co">#&gt; 4 ASCL1     EN2 0.790</span></span>
<span><span class="co">#&gt; 5 ASCL1    HES4 0.451</span></span>
<span><span class="va">motif</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;      V1     V2 V3</span></span>
<span><span class="co">#&gt; 1 ASCL1  RPAP3  0</span></span>
<span><span class="co">#&gt; 2 ASCL1  ACSM3  0</span></span>
<span><span class="co">#&gt; 3 ASCL1 CREBBP  0</span></span>
<span><span class="co">#&gt; 4 ASCL1 ZNF263  0</span></span>
<span><span class="co">#&gt; 5 ASCL1   RALA  0</span></span></code></pre></div>
<p>Now we locate our expression data. As an example, we will use a
subset of the GTEx version 7 RNA-Seq data, downloaded from <a href="https://gtexportal.org/home/datasets" class="external-link uri">https://gtexportal.org/home/datasets</a>. We start with a
subset of RNA-Seq data (tpm normalized) for 1,000 genes from 130 LCL
cell line samples and 407 whole blood samples.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dowload and load the GTEx expression matrix (tpm normalized expression)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O  https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/expression_tpm_lcl_blood_subset.txt"</span><span class="op">)</span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./expression_tpm_lcl_blood_subset.txt"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span>, check.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co"># Log transform the tpm normalized expression</span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">exp</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Determine the number of non-NA/non-zero rows in the expression data. This is to be able to ensure that PANDA will have enough values in the vectors to calculate pearson correlations between gene expression profiles in the construction of the gene co-expression prior.</span></span>
<span><span class="va">zero_na_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">exp</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Maintain only genes with at least 20 valid gene expression entries</span></span>
<span><span class="va">exp</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">[</span><span class="va">zero_na_counts</span> <span class="op">&gt;</span> <span class="fl">20</span>,<span class="op">]</span></span>
<span><span class="co"># # The set of genes in the expression, motif and ppi matrices must be the same</span></span>
<span><span class="co"># exp &lt;- exp[rownames(exp) %in% motif$V2,]</span></span>
<span><span class="co"># motif_subset &lt;- motif[(motif$V1 %in% rownames(exp)) &amp; (motif$V2 %in% rownames(exp)),]</span></span>
<span><span class="co"># ppi_subset &lt;- ppi[(ppi$V1 %in% motif_subset$V1) &amp; (ppi$V2 %in% motif_subset$V1),]</span></span>
<span><span class="co"># Load the sample ids of LCL samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O  https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/LCL_samples.txt"</span><span class="op">)</span></span>
<span><span class="va">lcl_samples</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./LCL_samples.txt"</span>, header<span class="op">=</span><span class="cn">FALSE</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Select the columns of the expression matrix corresponding to the LCL samples</span></span>
<span><span class="va">lcl_exp</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">lcl_samples</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># Load the sample ids of whole blood samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/WholeBlood_samples.txt"</span><span class="op">)</span></span>
<span><span class="va">wblood_samples</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./WholeBlood_samples.txt"</span>, header<span class="op">=</span><span class="cn">FALSE</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Select the columns of the expression matrix corresponding to the whole blood samples</span></span>
<span><span class="va">wb_exp</span> <span class="op">&lt;-</span> <span class="va">exp</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">exp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">wblood_samples</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Now we run PANDA, pointing it to the parsed expression data, motif
prior and ppi prior. We will point to the same motif and ppi priors for
each PANDA run, which represents the initial putative regulatory
information. We then point to the expression matrix correspoding to the
LCL samples to generate the LCL regulatory network, and to the
expression matrix corresponding to the whole blood samples to generate
the whole blood regulatory network.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pandaLCL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/panda.html" class="external-link">panda</a></span><span class="op">(</span><span class="va">motif</span>, <span class="va">lcl_exp</span>, <span class="va">ppi</span>, mode<span class="op">=</span><span class="st">"intersection"</span><span class="op">)</span></span>
<span><span class="va">pandaWB</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/panda.html" class="external-link">panda</a></span><span class="op">(</span><span class="va">motif</span>, <span class="va">wb_exp</span>, <span class="va">ppi</span>, mode<span class="op">=</span><span class="st">"intersection"</span><span class="op">)</span></span>
<span><span class="va">pandaLCL</span></span>
<span><span class="co">#&gt; PANDA network for968genes and50transcription factors.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slots:</span></span>
<span><span class="co">#&gt; regNet   : Regulatory network of 50 transcription factors to 968 genes.</span></span>
<span><span class="co">#&gt; coregNet: Co-regulation network of 968 genes.</span></span>
<span><span class="co">#&gt; coopNet  : Cooperative network of 50 transcription factors.</span></span>
<span><span class="co">#&gt; Regulatory graph contains 48400 edges.</span></span>
<span><span class="co">#&gt; Regulatory graph is complete.</span></span>
<span><span class="va">pandaWB</span></span>
<span><span class="co">#&gt; PANDA network for968genes and50transcription factors.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Slots:</span></span>
<span><span class="co">#&gt; regNet   : Regulatory network of 50 transcription factors to 968 genes.</span></span>
<span><span class="co">#&gt; coregNet: Co-regulation network of 968 genes.</span></span>
<span><span class="co">#&gt; coopNet  : Cooperative network of 50 transcription factors.</span></span>
<span><span class="co">#&gt; Regulatory graph contains 48400 edges.</span></span>
<span><span class="co">#&gt; Regulatory graph is complete.</span></span></code></pre></div>
<p>The regulatory network (bipartite graph) with edge weights
representing the “likelihood” that a transcription factor binds the
promotor of and regulates the expression of a gene.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The bipartite regulatory network (transcription factors as rows and target genes as columns)</span></span>
<span><span class="va">regNetLCL</span> <span class="op">&lt;-</span> <span class="va">pandaLCL</span><span class="op">@</span><span class="va">regNet</span></span>
<span><span class="va">regNetLCL</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;         RP4-669L17.8    MTND2P28        HES4     ACTRT2 RP3-467L1.6</span></span>
<span><span class="co">#&gt; ASCL1     -0.4338663 -0.06046052  0.43546720 -0.3541327  -0.1055712</span></span>
<span><span class="co">#&gt; BARX1     -0.5516320 -0.83640043 -0.68106570 -0.2683416   0.0649070</span></span>
<span><span class="co">#&gt; BHLHE41   -0.4478896 -0.22003403 -0.03953981 -0.2154970  -0.4435292</span></span>
<span><span class="co">#&gt; CEBPD     -0.1053101  0.06674693 -0.04042170 -0.2018673  -0.5209635</span></span>
<span><span class="co">#&gt; CEBPZ     -0.2151449 -0.16801549 -0.12427431 -0.3099354  -0.5307553</span></span>
<span><span class="va">regNetWB</span> <span class="op">&lt;-</span> <span class="va">pandaWB</span><span class="op">@</span><span class="va">regNet</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-networks-in-cytoscape">Visualizing networks in Cytoscape<a class="anchor" aria-label="anchor" href="#visualizing-networks-in-cytoscape"></a>
</h2>
<p>In this section we will visualize parts of the network using the
Cytoscape software. Download Cytoscape from: <a href="https://cytoscape.org" class="external-link uri">https://cytoscape.org</a> and
have the software open before calling the function.</p>
<div class="section level3">
<h3 id="preparing-data-to-plot">Preparing data to plot<a class="anchor" aria-label="anchor" href="#preparing-data-to-plot"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will use the function vis.panda.in.cytoscape to plot a set of nodes and edges on Cytoscape. The input for this function is a data.frame of edges to plot with 4 columns: "tf", "gene", "motif" (TF motif present or not on gene promoter), "force" (edge weight calculated by PANDA).</span></span>
<span><span class="va">lcl_vis</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">pandaLCL</span><span class="op">@</span><span class="va">regNet</span><span class="op">)</span></span>
<span><span class="va">wb_vis</span>  <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">pandaWB</span><span class="op">@</span><span class="va">regNet</span><span class="op">)</span></span>
<span><span class="va">lcl_vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"TF"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">lcl_vis</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="st">"Gene"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">lcl_vis</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,<span class="st">"Motif"</span><span class="op">=</span><span class="cn">NA</span>,<span class="st">"Score"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lcl_vis</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">wb_vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"TF"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">wb_vis</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="st">"Gene"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">wb_vis</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,<span class="st">"Motif"</span><span class="op">=</span><span class="cn">NA</span>,<span class="st">"Score"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">wb_vis</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lcl_vis</span><span class="op">)</span></span>
<span><span class="co">#&gt;        TF         Gene Motif      Score</span></span>
<span><span class="co">#&gt; 1   ASCL1 RP4-669L17.8    NA -0.4338663</span></span>
<span><span class="co">#&gt; 2   BARX1 RP4-669L17.8    NA -0.5516320</span></span>
<span><span class="co">#&gt; 3 BHLHE41 RP4-669L17.8    NA -0.4478896</span></span>
<span><span class="co">#&gt; 4   CEBPD RP4-669L17.8    NA -0.1053101</span></span>
<span><span class="co">#&gt; 5   CEBPZ RP4-669L17.8    NA -0.2151449</span></span>
<span><span class="co">#&gt; 6   CENPB RP4-669L17.8    NA -0.1024927</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-the-200-highest-edge-weights">Plot the 200 highest edge weights<a class="anchor" aria-label="anchor" href="#plot-the-200-highest-edge-weights"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span><span class="op">=</span><span class="fl">200</span> <span class="co"># number of edges to plot </span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">lcl_vis</span><span class="op">$</span><span class="va">Score</span>,decreasing<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span><span class="va">lcl_vis_top</span> <span class="op">&lt;-</span> <span class="va">lcl_vis</span><span class="op">[</span><span class="va">top</span>,<span class="op">]</span></span>
<span><span class="co"># Plot in cytoscape (open Cytoscape before running this command)</span></span>
<span><span class="fu"><a href="../reference/visPandaInCytoscape.html">visPandaInCytoscape</a></span><span class="op">(</span><span class="va">lcl_vis_top</span>, network_name<span class="op">=</span><span class="st">"LCL"</span><span class="op">)</span></span>
<span><span class="co"># Here we will load a customized visual style for our network, in which TF nodes are orange circles, target gene nodes are blue squares, and edges shade and width are the edge weight (likelyhood of regulatory interaction between the TF and gene). You can further customize the network style directly from Cytoscape.</span></span>
<span><span class="fu"><a href="../reference/createPandaStyle.html">createPandaStyle</a></span><span class="op">(</span>style_name<span class="op">=</span><span class="st">"PandaStyle"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-the-top-differential-edges-betwen-lcl-and-wb">Plot the top differential edges betwen LCL and WB<a class="anchor" aria-label="anchor" href="#plot-the-top-differential-edges-betwen-lcl-and-wb"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the top differential edge weights betweeen LCL and whole blood</span></span>
<span><span class="va">diffRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pandaDiffEdges.html">pandaDiffEdges</a></span><span class="op">(</span><span class="va">lcl_vis</span>, <span class="va">wb_vis</span>, condition_name<span class="op">=</span><span class="st">"LCL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diffRes</span><span class="op">)</span></span>
<span><span class="co"># Number of differential edges is:</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">diffRes</span><span class="op">)</span></span>
<span><span class="co"># Select the top differential edges higher in LCL to plot in Cytoscape</span></span>
<span><span class="va">n</span><span class="op">=</span><span class="fl">200</span> <span class="co"># number of edges to select from each condition</span></span>
<span><span class="va">diffResLCL</span> <span class="op">&lt;-</span> <span class="va">diffRes</span><span class="op">[</span><span class="va">diffRes</span><span class="op">$</span><span class="va">LCL</span><span class="op">==</span><span class="st">"T"</span>,<span class="op">]</span></span>
<span><span class="va">diffResLCL</span> <span class="op">&lt;-</span> <span class="va">diffResLCL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">diffResLCL</span><span class="op">$</span><span class="va">Score</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>,<span class="op">]</span></span>
<span><span class="co"># Select the top differential edges higher in whole blood to plot in Cytoscape</span></span>
<span><span class="va">diffResWB</span> <span class="op">&lt;-</span> <span class="va">diffRes</span><span class="op">[</span><span class="va">diffRes</span><span class="op">$</span><span class="va">LCL</span><span class="op">==</span><span class="st">"F"</span>,<span class="op">]</span></span>
<span><span class="va">diffResWB</span> <span class="op">&lt;-</span> <span class="va">diffResWB</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">diffResWB</span><span class="op">$</span><span class="va">Score</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>,<span class="op">]</span></span>
<span><span class="co"># Combine top differential edges in LCL and WB to plot in Cytoscape</span></span>
<span><span class="va">diffRes_vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">diffResLCL</span>, <span class="va">diffResWB</span><span class="op">)</span></span>
<span><span class="co"># Plot the network (open Cytoscape before running this command)</span></span>
<span><span class="co"># Purple edges indicate higher edge weight in the defined "condition_name" parameter (LCL in our example), and green edges indicate higher edge weight in the other condition (whole blood in our example).</span></span>
<span><span class="fu">visDiffPandaInCytoscape</span><span class="op">(</span><span class="va">diffRes_vis</span>, condition_name <span class="op">=</span> <span class="st">"LCL"</span>, network_name<span class="op">=</span><span class="st">"diff.PANDA"</span><span class="op">)</span></span>
<span><span class="co"># Apply the style to the network</span></span>
<span><span class="fu">createDiffPandaStyle</span><span class="op">(</span>style_name<span class="op">=</span><span class="st">"Diff.PandaStyle"</span>, condition_name<span class="op">=</span><span class="st">"LCL"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="calculating-degree">Calculating degree<a class="anchor" aria-label="anchor" href="#calculating-degree"></a>
</h2>
<ul>
<li>out-degrees of TFs: sum of the weights of outbound edges around a
TF</li>
<li>in-degrees of genes: sum of the weights of inbound edges around a
gene</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcl_outdegree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/calcDegree.html" class="external-link">calcDegree</a></span><span class="op">(</span><span class="va">pandaLCL</span>, type<span class="op">=</span><span class="st">"tf"</span><span class="op">)</span></span>
<span><span class="va">wb_outdegree</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/calcDegree.html" class="external-link">calcDegree</a></span><span class="op">(</span><span class="va">pandaWB</span>, type<span class="op">=</span><span class="st">"tf"</span><span class="op">)</span></span>
<span><span class="va">lcl_indegree</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/calcDegree.html" class="external-link">calcDegree</a></span><span class="op">(</span><span class="va">pandaLCL</span>, type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="va">wb_indegree</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/calcDegree.html" class="external-link">calcDegree</a></span><span class="op">(</span><span class="va">pandaWB</span>, type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="co"># Calculate the gene in-degree difference for two different panda regulatory networks (LCL minus whole blood)</span></span>
<span><span class="va">degreeDiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pandaR/man/calcDegreeDifference.html" class="external-link">calcDegreeDifference</a></span><span class="op">(</span><span class="va">pandaLCL</span>, <span class="va">pandaWB</span>, type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">degreeDiff</span><span class="op">)</span></span>
<span><span class="co">#&gt; RP4-669L17.8     MTND2P28         HES4       ACTRT2  RP3-467L1.6        FBXO6 </span></span>
<span><span class="co">#&gt;   -0.4731904   -4.5354668   -0.7550223    0.6174926    0.2393536   -0.5087543</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gene-set-enrichment-analysis">Gene Set Enrichment Analysis<a class="anchor" aria-label="anchor" href="#gene-set-enrichment-analysis"></a>
</h2>
<p>Well will use the fgsea package to perform gene set enrichment
analysis. We need to point to a ranked gene list (for example the gene
in-degree difference between LCL and whole blood), and a list of gene
sets (or signatures) in gmt format to test for enrichment. The gene sets
can be downloaded from MSigDB: <a href="http://software.broadinstitute.org/gsea/msigdb" class="external-link uri">http://software.broadinstitute.org/gsea/msigdb</a> Same gene
annotation should be used in the ranked gene list and gene sets. In our
example we will use the KEGG pathways downloaded from MSigDB.</p>
<div class="section level3">
<h3 id="run-fgsea">Run fgsea<a class="anchor" aria-label="anchor" href="#run-fgsea"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O  https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/c2.cp.kegg.v7.0.symbols.gmt"</span><span class="op">)</span></span>
<span><span class="va">pathways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fgsea/man/gmtPathways.html" class="external-link">gmtPathways</a></span><span class="op">(</span><span class="st">"./c2.cp.kegg.v7.0.symbols.gmt"</span><span class="op">)</span></span>
<span><span class="co"># To retrieve biological-relevant processes, we will load and use the complete ranked gene list (27,175 genes) calculated from the complete network instead of the 1,000 subset genes we used in this tutorial example to build PANDA networks within a very short run time.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"curl -O  https://netzoo.s3.us-east-2.amazonaws.com/netZooR/tutorial_datasets/lclWB_indegreeDifference.rnk"</span><span class="op">)</span></span>
<span><span class="va">degreeDiff_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"./lclWB_indegreeDifference.rnk"</span>,stringsAsFactors <span class="op">=</span> <span class="cn">F</span>,header<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">degreeDiff_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">degreeDiff_all</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">degreeDiff_all</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">fgseaRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fgsea/man/fgsea.html" class="external-link">fgsea</a></span><span class="op">(</span><span class="va">pathways</span>, <span class="va">degreeDiff_all</span>, minSize<span class="op">=</span><span class="fl">15</span>, maxSize<span class="op">=</span><span class="fl">500</span>, nperm<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fgseaRes</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                          pathway        pval       padj</span></span>
<span><span class="co">#&gt;                                           &lt;char&gt;       &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:               KEGG_GLYCOLYSIS_GLUCONEOGENESIS 0.057603687 0.15055159</span></span>
<span><span class="co">#&gt; 2:                  KEGG_CITRATE_CYCLE_TCA_CYCLE 0.001808318 0.01807792</span></span>
<span><span class="co">#&gt; 3:                KEGG_PENTOSE_PHOSPHATE_PATHWAY 0.094623656 0.20761364</span></span>
<span><span class="co">#&gt; 4: KEGG_PENTOSE_AND_GLUCURONATE_INTERCONVERSIONS 0.642543860 0.73554363</span></span>
<span><span class="co">#&gt; 5:          KEGG_FRUCTOSE_AND_MANNOSE_METABOLISM 0.051454139 0.14171091</span></span>
<span><span class="co">#&gt; 6:                     KEGG_GALACTOSE_METABOLISM 0.041666667 0.11911367</span></span>
<span><span class="co">#&gt;            ES        NES nMoreExtreme  size  leadingEdge</span></span>
<span><span class="co">#&gt;         &lt;num&gt;      &lt;num&gt;        &lt;num&gt; &lt;int&gt;       &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:  0.3355458  1.4050946           24    58 ALDH3B1,....</span></span>
<span><span class="co">#&gt; 2: -0.5923935 -2.0115444            0    29 MDH2, CS....</span></span>
<span><span class="co">#&gt; 3:  0.4235984  1.3720452           43    21 H6PD, PG....</span></span>
<span><span class="co">#&gt; 4:  0.2675875  0.8785935          292    22 UGT1A10,....</span></span>
<span><span class="co">#&gt; 5:  0.4168076  1.4704361           22    30 PFKFB4, ....</span></span>
<span><span class="co">#&gt; 6:  0.4491757  1.5310429           18    25 GAA, PGM....</span></span>
<span><span class="co"># Subset to pathways with FDR &lt; 0.05</span></span>
<span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="va">fgseaRes</span><span class="op">[</span><span class="va">fgseaRes</span><span class="op">$</span><span class="va">padj</span> <span class="op">&lt;</span> <span class="fl">0.05</span>,<span class="op">]</span></span>
<span><span class="co"># Get the top 10 significant pathways enriched for genes having lower targeting in LCLs  </span></span>
<span><span class="va">sig</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">sig</span><span class="op">$</span><span class="va">NES</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;                              pathway        pval       padj         ES</span></span>
<span><span class="co">#&gt;                               &lt;char&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:                 KEGG_SPLICEOSOME 0.001663894 0.01807792 -0.6155980</span></span>
<span><span class="co">#&gt;  2:                    KEGG_RIBOSOME 0.001715266 0.01807792 -0.6438056</span></span>
<span><span class="co">#&gt;  3:             KEGG_DNA_REPLICATION 0.001814882 0.01807792 -0.7301502</span></span>
<span><span class="co">#&gt;  4:                  KEGG_CELL_CYCLE 0.001636661 0.01807792 -0.5352336</span></span>
<span><span class="co">#&gt;  5:  KEGG_NUCLEOTIDE_EXCISION_REPAIR 0.001751313 0.01807792 -0.5896497</span></span>
<span><span class="co">#&gt;  6:              KEGG_PROTEIN_EXPORT 0.001831502 0.01807792 -0.6735362</span></span>
<span><span class="co">#&gt;  7: KEGG_AMINOACYL_TRNA_BIOSYNTHESIS 0.001730104 0.01807792 -0.5489421</span></span>
<span><span class="co">#&gt;  8:     KEGG_CITRATE_CYCLE_TCA_CYCLE 0.001808318 0.01807792 -0.5923935</span></span>
<span><span class="co">#&gt;  9: KEGG_BASAL_TRANSCRIPTION_FACTORS 0.001808318 0.01807792 -0.5641948</span></span>
<span><span class="co">#&gt; 10:             KEGG_MISMATCH_REPAIR 0.001831502 0.01807792 -0.5977217</span></span>
<span><span class="co">#&gt;           NES nMoreExtreme  size  leadingEdge</span></span>
<span><span class="co">#&gt;         &lt;num&gt;        &lt;num&gt; &lt;int&gt;       &lt;list&gt;</span></span>
<span><span class="co">#&gt;  1: -2.746048            0   116 SRSF6, S....</span></span>
<span><span class="co">#&gt;  2: -2.684127            0    80 RPS2, RP....</span></span>
<span><span class="co">#&gt;  3: -2.565485            0    34 RFC3, RF....</span></span>
<span><span class="co">#&gt;  4: -2.414211            0   121 YWHAQ, O....</span></span>
<span><span class="co">#&gt;  5: -2.180035            0    41 XPA, RFC....</span></span>
<span><span class="co">#&gt;  6: -2.133004            0    22 SRP9, IM....</span></span>
<span><span class="co">#&gt;  7: -2.024561            0    40 MARS2, N....</span></span>
<span><span class="co">#&gt;  8: -2.011544            0    29 MDH2, CS....</span></span>
<span><span class="co">#&gt;  9: -1.947689            0    31 TAF4, TA....</span></span>
<span><span class="co">#&gt; 10: -1.892909            0    22 RFC3, RF....</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bubble-plot-of-top-differentially-targeted-pathways">Bubble plot of top differentially targeted pathways<a class="anchor" aria-label="anchor" href="#bubble-plot-of-top-differentially-targeted-pathways"></a>
</h3>
<p>Bubble plot of gene sets (KEGG pathways) on y-axis and adjusted
p-value (padj) on x-axis. Bubble size indicates the number of genes in
each gene set, and bubble color indicates the normalized enrichment
score (NES). Blue is for negative NES (enrichment of higher targeted
genes in whole blood), and red is for positive NES (enrichment of higher
targeted genes in LCL).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">fgseaRes</span><span class="op">)</span></span>
<span><span class="co"># Settings</span></span>
<span><span class="va">fdrcut</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co"># FDR cut-off to use as output for significant signatures</span></span>
<span><span class="va">dencol_neg</span> <span class="op">&lt;-</span> <span class="st">"blue"</span> <span class="co"># bubble plot color for negative ES</span></span>
<span><span class="va">dencol_pos</span> <span class="op">&lt;-</span> <span class="st">"red"</span> <span class="co"># bubble plot color for positive ES</span></span>
<span><span class="va">signnamelength</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="co"># set to remove prefix from signature names (2 for "GO", 4 for "KEGG", 8 for "REACTOME")</span></span>
<span><span class="va">asp</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># aspect ratio of bubble plot</span></span>
<span><span class="va">charcut</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># cut signature name in heatmap to this nr of characters</span></span>
<span><span class="co"># Make signature names more readable</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">pathway</span><span class="op">)</span> <span class="co"># 'a' is a great variable name to substitute row names with something more readable</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">signnamelength</span><span class="op">+</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="co"># convert to lower case (you may want to comment this out, it really depends on what signatures you are looking at, c6 signatures contain gene names, and converting those to lower case may be confusing)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">&gt;</span><span class="va">charcut</span><span class="op">)</span> <span class="op">{</span> <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">charcut</span><span class="op">)</span>, <span class="st">"..."</span>, sep<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="op">}</span> <span class="co"># cut signature names that have more characters than charcut, and add "..."</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">NAME</span> <span class="op">&lt;-</span> <span class="va">a</span></span>
<span><span class="co"># Determine what signatures to plot (based on FDR cut)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">[</span>,<span class="st">"padj"</span><span class="op">]</span><span class="op">&lt;</span><span class="va">fdrcut</span>,<span class="op">]</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">[</span>,<span class="st">"padj"</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span> </span>
<span><span class="va">dat2</span><span class="op">$</span><span class="va">signature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">NAME</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Determine what labels to color</span></span>
<span><span class="va">sign_neg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">[</span>,<span class="st">"NES"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sign_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">[</span>,<span class="st">"NES"</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># Color labels</span></span>
<span><span class="va">signcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">signature</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">signcol</span><span class="op">[</span><span class="va">sign_neg</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dencol_neg</span> <span class="co"># text color of negative signatures</span></span>
<span><span class="va">signcol</span><span class="op">[</span><span class="va">sign_pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dencol_pos</span> <span class="co"># text color of positive signatures</span></span>
<span><span class="va">signcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">signcol</span><span class="op">)</span> <span class="co"># need to revert vector of colors, because ggplot starts plotting these from below</span></span>
<span><span class="co"># Plot bubble plot</span></span>
<span><span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">padj</span>,y<span class="op">=</span><span class="va">signature</span>,size<span class="op">=</span><span class="va">size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">NES</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">21</span>, colour<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="co"># white background, needs to be placed before the "signcol" line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">fdrcut</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>max_size<span class="op">=</span><span class="fl">10</span>,guide<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="va">dencol_neg</span>, high<span class="op">=</span><span class="va">dencol_pos</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">signcol</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio<span class="op">=</span><span class="va">asp</span>, axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># test aspect.ratio</span></span></code></pre></div>
<p><img src="pandaRApplicationinGTExData_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marouen Ben Guebila, Tian Wang, John Platig, Marieke Kuijjer, Megha Padi, Rebekka Burkholz, Des Weighill, Kate Shutta.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
